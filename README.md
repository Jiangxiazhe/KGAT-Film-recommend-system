# 基于知识图谱注意力网络（KGAT）的电影推荐系统

## 1. 项目简介

本项目是一个基于知识图谱和图神经网络的电影推荐系统。它利用 **MovieLens-1M** 数据集，通过以下步骤实现电影推荐功能：

1.  **知识图谱构建**: 从用户的基本信息（性别、年龄、职业）、电影信息（类型、年份）以及用户对电影的评分数据中提取实体和关系，构建一个异构知识图谱。
2.  **模型训练**: 采用**知识图谱注意力网络（KGAT）**模型，在构建好的知识图谱上进行端到端的训练。模型学习用户和物品（电影）的嵌入表示，并结合图谱中的高阶关系信息进行预测。
3.  **电影推荐**: 对于给定的用户，系统能够利用训练好的模型预测其对未看过电影的评分，并生成一个Top-K推荐列表。
4.  **冷启动支持**: 项目代码中包含了对冷启动用户的评估，验证了模型在面对新用户时的推荐能力。
5.  **数据可视化**: 支持将知识图谱导入 **Neo4j** 图数据库，方便进行可视化分析和查询。

## 2. 环境依赖

在运行本项目之前，请确保您已安装以下Python库。您可以通过pip进行安装：

```bash
pip install pandas torch scikit-learn torch-geometric matplotlib neo4j
```

同时，您需要下载 **MovieLens-1M** 数据集，并将其解压到项目的 `ml-1m` 文件夹下。

- **数据集下载地址**: [MovieLens 1M Dataset](https://grouplens.org/datasets/movielens/1m/)

## 3. 项目运行流程

### 步骤 1: 数据预处理与知识图谱构建

首先，运行数据处理脚本。该脚本会执行以下操作：
- 加载 `ml-1m` 原始数据。
- 划分训练集、测试集和冷启动用户集。
- 从数据中提取实体和关系，构建知识图谱三元组，并保存为 `kg_final.txt`、`entity2id.txt` 和 `relation2id.txt`。

```bash
python data_process.py
```

### 步骤 2: 模型训练

运行主训练脚本来训练KGAT模型。训练完成后，最优模型将保存在 `model/` 目录下。

```bash
python kgb.py
```

### 步骤 3: 查看推荐结果

运行推荐系统脚本，输入一个用户ID和期望的推荐数量，即可获得电影推荐列表。

```bash
python system.py
```
程序会提示您输入 `用户ID` 和 `推荐电影数量`。

### 步骤 4: 模型评估

如果您想评估模型的性能（如AUC、Precision@K、Recall@K），可以运行测试脚本。

```bash
python test.py
```

### (可选) 步骤 5: 将知识图谱导入 Neo4j

如果您希望将构建的知识图谱进行可视化，可以将其导入Neo4j数据库。

**前置条件**:
- 确保您的本地Neo4j服务正在运行。
- 修改 `new2neo4j.py` 文件中的Neo4j连接配置（URI, USER, PASSWORD）。

然后运行以下命令：

```bash
python new2neo4j.py
```

## 4. 文件结构

```
.
├── ml-1m/                # MovieLens-1M 原始数据
├── model/                # 存放训练好的模型文件 (*.pth)
├── pre_data/             # 存放预处理后的数据 (*.csv)
├── data_process.py       # 数据预处理与知识图谱构建脚本
├── kgb.py                # 模型训练主脚本
├── kgat.py               # KGAT 模型定义
├── system.py             # 推荐系统应用脚本
├── test.py               # 模型评估脚本
├── new2neo4j.py          # 导入数据到 Neo4j 的脚本
├── README.md             # 本文档
└── ...
```
